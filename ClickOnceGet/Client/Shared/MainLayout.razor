@inherits LayoutComponentBase
@inject HttpClient HttpClient
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager

<div>
    <MudAppBar Position="Position.Static" Class="">
        <h1><a href="/">ClickOnce Get</a></h1>

        <MudAppBarSpacer />

        <AuthorizeView>
            <Authorized>
                <span class="user-view">
                    <MudAvatar Image="@($"https://avatars.githubusercontent.com/{context.User.Identity.Name}")" Size="Size.Medium" alt="@context.User.Identity.Name" />
                    @context.User.Identity.Name
                    <MudMenu Icon="@Icons.Material.MoreVert" Color="Color.Inherit">
                        <MudMenuItem OnClick="OnClickMageApps">Manage applications</MudMenuItem>
                        <MudMenuItem OnClick="OnClickSignOut">Sign out</MudMenuItem>
                    </MudMenu>
                </span>
            </Authorized>
            <NotAuthorized>
                <MudButton Link="auth/signin" Target="_top" Color="Color.Inherit" Variant="Variant.Text">
                    Sign In
                </MudButton>
            </NotAuthorized>
        </AuthorizeView>

    </MudAppBar>
</div>
<div>
    @Body
</div>

@code {
    private async Task OnClickSignOut()
    {
        await this.HttpClient.PostAsync("auth/signout", new StringContent(""));
        await (AuthStateProvider as ClientSideAuthenticationStateProvider)?.RefreshAsync();
    }

    public void OnClickMageApps()
    {
        NavigationManager.NavigateTo("myapps");
    }
}